{"paragraphs":[{"text":"import org.apache.commons.io.IOUtils\nimport java.net.URL\nimport java.nio.charset.Charset\nimport org.apache.spark.sql.functions.unix_timestamp\n\n// create case class Grouptime\ncase class Grouptime(ip:String, time :String, content:String)\n\nval input = sc.textFile(\"/home/ntm/Desktop/access_log/ip_time_content_5day.txt\")\n\nval data_parse =  input.map(s => s.split(\",\")).map(s => Grouptime(s(0).toString,s(1).toString,s(2).toString))\n\n// cast time(String) to timestamp\nval data_frame = data_parse.toDF().withColumn(\"timestamp\", unix_timestamp($\"time\",\"dd/MMM/yyyy:HH:mm:ss\").cast(\"timestamp\"))\ndata_frame.show()\n\nval data_1min = data_frame.filter(\"timestamp BETWEEN '2016-11-23 01:00:00' AND '2016-11-23 02:00:00' \")\nval data = data_1min.rdd.map(row => row.toString())\nval file = data.map(x =>x.replaceAll(\"[\\\\[\\\\]]\",\"\"))\n\n","user":"anonymous","dateUpdated":"2018-03-16T12:24:04+0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521175301743_816566857","id":"20180316-114141_1880671061","dateCreated":"2018-03-16T11:41:41+0700","dateStarted":"2018-03-16T12:24:04+0700","dateFinished":"2018-03-16T12:24:10+0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:514"},{"text":"val regex = \"/.+\"\n\nval split_word = file.flatMap(line => line.split(\",\").filter(x => x.matches(regex))).map(word => (word,1.toLong)).reduceByKey(_+_)\n\n \nval splitsort = split_word.sortBy(x => -x._2)\nval x = splitsort.map { case (k, v) => s\"$k,$v\" }\nval id_content_number = x.zipWithIndex().map{ case(line,count) => {(count+1).toString + \",\" + line }}\nid_content_number.coalesce(1,true).saveAsTextFile(\"/home/ntm/Desktop/output4\")\n\ncase class ContentCount(id:Long, content:String,count_id:Long)\n\nval logip = id_content_number.map(s => s.split(\",\")).map(\n    s => ContentCount(s(0).toLong, s(1).toString,s(2).toLong)\n    ).toDF()\nlogip.registerTempTable(\"logContent\")","user":"anonymous","dateUpdated":"2018-03-16T12:24:14+0700","config":{"colWidth":12,"enabled":true,"results":{"0":{"graph":{"mode":"multiBarChart","height":300,"optionOpen":false},"helium":{}}},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521175312164_-1421517495","id":"20180316-114152_687047485","dateCreated":"2018-03-16T11:41:52+0700","dateStarted":"2018-03-16T12:24:14+0700","dateFinished":"2018-03-16T12:24:25+0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:515"},{"text":"\n\nval regex = \"[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}.[0-9]{1,3}\"\n//val regex = \"/.+\"\n\nval split_word = file.flatMap(line => line.split(\",\").filter(x => x.matches(regex))).map(word => (word,1.toLong)).reduceByKey(_+_)\n\nval splitsort = split_word.sortBy(x => -x._2)\nval output = splitsort.map { case (k, v) => s\"$k,$v\" }\noutput.coalesce(1,true).saveAsTextFile(\"/home/ntm/Desktop/output3\")\n\ncase class IPCount(ip:String, count_ip:Long)\n\nval logip1 = output.map(s => s.split(\",\")).map(\n    s => IPCount(s(0), s(1).toLong)\n    ).toDF()\nlogip1.registerTempTable(\"logip1\")\n","user":"anonymous","dateUpdated":"2018-03-16T12:46:48+0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521175516500_-1031119431","id":"20180316-114516_1307249830","dateCreated":"2018-03-16T11:45:16+0700","status":"ERROR","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:516"},{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1521177953389_1800357162","id":"20180316-122553_2109132542","dateCreated":"2018-03-16T12:25:53+0700","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:517"}],"name":"testtsts","id":"2D99CSZYD","angularObjects":{"2D9G31WW7:shared_process":[],"2D7F5WZ3Y:shared_process":[],"2D7GMNNGQ:shared_process":[],"2D7GSW1AW:shared_process":[],"2D9C611XK:shared_process":[],"2D8XS5NZK:shared_process":[],"2DAC6TT6G:shared_process":[],"2D93XZNV7:shared_process":[],"2D84T2E7F:shared_process":[],"2DAAN1PZW:shared_process":[],"2D93ZAZ99:shared_process":[],"2DA3RJ3HV:shared_process":[],"2D8F1CDRV:shared_process":[],"2D7N6J63A:shared_process":[],"2D7343SYH:shared_process":[],"2D9XB5X1M:shared_process":[],"2DAEXMG5R:shared_process":[],"2D9ST5PKZ:shared_process":[],"2D71VY8MX:shared_process":[],"2D9MPEZKV:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}