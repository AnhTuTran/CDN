{"paragraphs":[{"text":"import org.apache.commons.io.IOUtils\nimport java.net.URL\nimport java.nio.charset.Charset\nimport org.apache.spark.sql.functions.unix_timestamp\n\n// create case class Grouptime\ncase class Grouptime(ip:String, time :String, content:String)\n\nval input = sc.textFile(\"/home/ntm/Desktop/access_log/ip_time_content\")\n\n\nval data_parse =  input.map(s => s.split(\",\")).map(s => Grouptime(s(0).toString,s(1).toString,s(2).toString))\n\n// cast time(String) to timestamp\nval data_frame = data_parse.toDF().withColumn(\"timestamp\", unix_timestamp($\"time\",\"dd/MMM/yyyy:HH:mm:ss\").cast(\"timestamp\"))\ndata_frame.show()\n\n// groupBy follow time asc\nval data_full = data_frame.groupBy(window($\"timestamp\", \"2 seconds\").as(\"time_interval\"))\n    .agg(collect_list(\"ip\"),collect_list(\"content\"))\n    .orderBy($\"time_interval\".asc)\n    \ndata_full.show()\ndata_full.registerTempTable(\"data_full\")\n","user":"anonymous","dateUpdated":"2018-03-13T14:25:05+0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"editorMode":"ace/mode/scala","editorHide":false},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1520308545469_-169068213","id":"20180306-105545_993799470","dateCreated":"2018-03-06T10:55:45+0700","dateStarted":"2018-03-13T13:40:24+0700","dateFinished":"2018-03-13T13:41:00+0700","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:5072","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"import org.apache.commons.io.IOUtils\nimport java.net.URL\nimport java.nio.charset.Charset\nimport org.apache.spark.sql.functions.unix_timestamp\ndefined class Grouptime\ninput: org.apache.spark.rdd.RDD[String] = /home/ntm/Desktop/access_log/ip_time_content MapPartitionsRDD[730] at textFile at <console>:337\ndata_parse: org.apache.spark.rdd.RDD[Grouptime] = MapPartitionsRDD[732] at map at <console>:341\ndata_frame: org.apache.spark.sql.DataFrame = [ip: string, time: string ... 2 more fields]\n+---------------+--------------------+--------------------+-------------------+\n|             ip|                time|             content|          timestamp|\n+---------------+--------------------+--------------------+-------------------+\n|116.118.106.106|08/Nov/2016:12:00:29|/includes/css/hcm...|2016-11-08 12:00:29|\n|116.118.106.107|08/Nov/2016:12:00:29|/includes/css/hcm...|2016-11-08 12:00:29|\n|  14.187.82.206|08/Nov/2016:12:00:29|/includes/js/jque...|2016-11-08 12:00:29|\n|   14.187.91.66|08/Nov/2016:12:00:29|/includes/js/jque...|2016-11-08 12:00:29|\n| 113.162.189.51|08/Nov/2016:12:00:29|/includes/js/jque...|2016-11-08 12:00:29|\n| 180.93.229.181|08/Nov/2016:12:00:29|/includes/js/jque...|2016-11-08 12:00:29|\n|  14.187.82.216|08/Nov/2016:12:00:29|/includes/js/jque...|2016-11-08 12:00:29|\n| 180.93.227.156|08/Nov/2016:12:00:29|/includes/js/jque...|2016-11-08 12:00:29|\n|  180.93.231.30|08/Nov/2016:12:00:29|/includes/js/hcmu...|2016-11-08 12:00:29|\n|  180.93.230.47|08/Nov/2016:12:00:29|/includes/js/hcmu...|2016-11-08 12:00:29|\n|116.118.106.104|08/Nov/2016:12:00:29|/images/hcmut/tin...|2016-11-08 12:00:29|\n|116.118.106.105|08/Nov/2016:12:00:29|/images/hcmut/tin...|2016-11-08 12:00:29|\n|116.118.106.106|08/Nov/2016:12:00:29|/images/hcmut/but...|2016-11-08 12:00:29|\n|116.118.106.107|08/Nov/2016:12:00:29|/images/hcmut/but...|2016-11-08 12:00:29|\n|  14.187.82.206|08/Nov/2016:12:00:29|/upload/slide_sho...|2016-11-08 12:00:29|\n|  14.187.82.206|08/Nov/2016:12:00:29|/upload/slide_sho...|2016-11-08 12:00:29|\n|  14.187.82.206|08/Nov/2016:12:00:29|/upload/slide_sho...|2016-11-08 12:00:29|\n|  14.187.82.206|08/Nov/2016:12:00:29|/upload/slide_sho...|2016-11-08 12:00:29|\n|  14.187.82.206|08/Nov/2016:12:00:29|/upload/slide_sho...|2016-11-08 12:00:29|\n|  14.187.82.206|08/Nov/2016:12:00:29|/upload/slide_sho...|2016-11-08 12:00:29|\n+---------------+--------------------+--------------------+-------------------+\nonly showing top 20 rows\n\ndata_full: org.apache.spark.sql.Dataset[org.apache.spark.sql.Row] = [time_interval: struct<start: timestamp, end: timestamp>, collect_list(ip): array<string> ... 1 more field]\n+--------------------+--------------------+---------------------+\n|       time_interval|    collect_list(ip)|collect_list(content)|\n+--------------------+--------------------+---------------------+\n|[2016-11-08 12:00...|[116.118.106.106,...| [/includes/css/hc...|\n|[2016-11-08 12:00...|[180.93.231.30, 1...| [/upload/slide_sh...|\n|[2016-11-08 12:00...|[113.163.123.228,...| [/, /favicon.ico,...|\n|[2016-11-08 12:00...|[58.187.23.11, 58...| [/vi/event/view/t...|\n+--------------------+--------------------+---------------------+\n\nwarning: there was one deprecation warning; re-run with -deprecation for details\n"}]}},{"text":"","user":"anonymous","dateUpdated":"2018-03-06T16:09:22+0700","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala"},"tableHide":false,"editorHide":false,"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1520309469183_-148803525","id":"20180306-111109_441864714","dateCreated":"2018-03-06T11:11:09+0700","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:5074"}],"name":"log","id":"2D7XSUWMF","angularObjects":{"2D7F5WZ3Y:shared_process":[],"2D7GMNNGQ:shared_process":[],"2D7GSW1AW:shared_process":[],"2D9C611XK:shared_process":[],"2D8XS5NZK:shared_process":[],"2DAC6TT6G:shared_process":[],"2D93XZNV7:shared_process":[],"2D84T2E7F:shared_process":[],"2DAAN1PZW:shared_process":[],"2D93ZAZ99:shared_process":[],"2DA3RJ3HV:shared_process":[],"2D8F1CDRV:shared_process":[],"2D7N6J63A:shared_process":[],"2D7343SYH:shared_process":[],"2D9XB5X1M:shared_process":[],"2DAEXMG5R:shared_process":[],"2D9ST5PKZ:shared_process":[],"2D71VY8MX:shared_process":[],"2D9MPEZKV:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}